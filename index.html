<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <title>Wörterschatz</title>
        <style>
            div {
                display: grid;
                grid-template-columns: 3fr 1fr;
                border-bottom: 1px solid #ccc;
            }
            fieldset {
                width: 80%;
                margin-left: auto;
                margin-right: auto;
                max-width: 600px;
            }
            form {
                padding: 10%;
            }
        </style>
    </head>
    <body>
        <fieldset id="multiple-choice">
            <legend></legend>
            <div>
                <label for="case1"></label>
                <input id="case1" type="checkbox"/>
            </div>
            <div>
                <label for="case2"></label>
                <input id="case2" type="checkbox"/>
            </div>
            <div>
                <label for="case3"></label>
                <input id="case3" type="checkbox"/>
            </div>
        </fieldset>
        <fieldset id="input">
            <legend></legend>
            <div>
                <label for="word">Bedeutung</label>
                <input id="word" type="text"/>
            </div>
        </fieldset>
        <fieldset>
            <legend>Statistik</legend>
            <div>
                <label for="multiple-choice-meter">Multiple Choice</label>
                <meter value="0" min="0" max="0" id="multiple-choice-meter" title="Unbenutzt 0/0"></meter>
            </div>
            <div>
                <label for="input-meter">Eingabe</label>
                <meter value="0" min="0" max="0" id="input-meter" title="Unbenutzt 0/0"></meter>
            </div>
        </fieldset>
        <script>
            (() => {
                const stats = {};
                const fill = async () => {
                    const data = await (await fetch('/test.php')).json();
                    document.getElementById('input').setAttribute('style', 'display: none');
                    document.getElementById('multiple-choice').setAttribute('style', 'display: none');
                    if (typeof stats[data.type] === 'undefined') {
                        stats[data.type] = {
                            correct: 0,
                            asked: 0,
                        };
                    }
                    stats[data.type].asked++;
                    document.getElementById(data.type).removeAttribute('style');
                    if (data.type === 'multiple-choice') {
                        document.getElementsByTagName('legend')[0].innerText = data.question;
                        document.getElementsByTagName('label')[0].innerText = data.answers[0];
                        document.getElementsByTagName('label')[1].innerText = data.answers[1];
                        document.getElementsByTagName('label')[2].innerText = data.answers[2];
                        document.getElementsByTagName('input')[0].onchange = () => {
                            data.answer === 0 ? window.alert('Richtig!') : window.alert(data.answers[data.answer]);
                            stats[data.type].correct += data.answer === 0 ? 1 : 0;
                            fill();
                            document.getElementsByTagName('input')[0].checked = false;
                        };
                        document.getElementsByTagName('input')[1].onchange = () => {
                            data.answer === 1 ? window.alert('Richtig!') : window.alert(data.answers[data.answer]);
                            stats[data.type].correct += data.answer === 1 ? 1 : 0;
                            fill();
                            document.getElementsByTagName('input')[1].checked = false;
                        };
                        document.getElementsByTagName('input')[2].onchange = () => {
                            data.answer === 2 ? window.alert('Richtig!') : window.alert(data.answers[data.answer]);
                            stats[data.type].correct += data.answer === 2 ? 1 : 0;
                            fill();
                            document.getElementsByTagName('input')[2].checked = false;
                        };
                    } else if (data.type === 'input') {
                        document.getElementsByTagName('legend')[1].innerText = data.question;
                        document.getElementsByTagName('input')[3].onchange = () => {
                            data.answer === document.getElementsByTagName('input')[3].value ? window.alert('Richtig!') : window.alert(data.answer);
                            stats[data.type].correct += data.answer === document.getElementsByTagName('input')[3].value ? 1 : 0;
                            fill();
                            document.getElementsByTagName('input')[3].value = '';
                        };
                    } else {
                        alert('Unverständliche Aufgabe, lade neu!');
                        window.location.reload();
                    }
                    for (const key of Object.keys(stats)) {
                        const element = document.getElementById(key + '-meter');
                        element.setAttribute('title', stats.correct + '/' + stats.asked);
                        element.setAttribute('value', stats.correct);
                        element.setAttribute('max', stats.asked);
                    }
                };
                fill();
            })();
        </script>
    </body>
</html>
